<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>我的私人网盘</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif}
body{background:#f2f5fa;padding:20px}
.container{max-width:900px;margin:0 auto}
.header{text-align:center;margin-bottom:30px}
.header h1{font-size:26px;color:#222;margin-bottom:10px}
.search-box{margin-bottom:20px}
.search-input{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:15px}
.upload-box{background:white;padding:25px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);margin-bottom:25px}
.upload-btn{background:#0071e3;color:white;padding:12px 20px;border:none;border-radius:8px;cursor:pointer;font-size:15px}
.upload-btn:hover{background:#0077ed}
#file-input{display:none}
.file-list{background:white;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
.file-item{display:flex;justify-content:space-between;align-items:center;padding:12px 10px;border-bottom:1px solid #eee}
.file-item:last-child{border-bottom:none}
.file-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.del-btn{color:white;background:#ff3b30;padding:6px 12px;border:none;border-radius:6px;cursor:pointer}
.del-btn:hover{background:#ff453a}
.download-btn{margin-right:8px;background:#0071e3;color:white;padding:6px 12px;border:none;border-radius:6px;cursor:pointer}
.alert{color:#ff3b30;margin-top:10px;font-size:14px}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>私人本地网盘</h1>
    <p>文件存在本地浏览器，刷新不丢失</p>
  </div>

  <div class="search-box">
    <input type="text" class="search-input" placeholder="搜索文件名..." id="search-input">
  </div>

  <div class="upload-box">
    <button class="upload-btn" onclick="document.getElementById('file-input').click()">选择文件上传</button>
    <input type="file" id="file-input" multiple>
    <div class="alert" id="alert"></div>
  </div>

  <div class="file-list" id="file-list">
    <div style="color:#999;text-align:center;padding:20px">暂无文件</div>
  </div>
</div>

<script>
const fileInput = document.getElementById('file-input');
const fileList = document.getElementById('file-list');
const searchInput = document.getElementById('search-input');
const alert = document.getElementById('alert');
const MAX_SIZE = 50 * 1024 * 1024; // 最大50MB

// 加载保存的文件
function loadFiles() {
  let files = JSON.parse(localStorage.getItem('myDiskFiles') || '[]');
  renderFiles(files);
}

// 渲染文件列表
function renderFiles(files) {
  if (files.length === 0) {
    fileList.innerHTML = '<div style="color:#999;text-align:center;padding:20px">暂无文件</div>';
    return;
  }
  fileList.innerHTML = files.map((f, i) => `
    <div class="file-item">
      <div class="file-name">${f.name}</div>
      <div>
        <button class="download-btn" onclick="downloadFile(${i})">下载</button>
        <button class="del-btn" onclick="deleteFile(${i})">删除</button>
      </div>
    </div>
  `).join('');
}

// 上传
fileInput.onchange = async (e) => {
  let arr = Array.from(e.target.files);
  let old = JSON.parse(localStorage.getItem('myDiskFiles') || '[]');
  alert.textContent = '';
  
  for (let file of arr) {
    if (file.size > MAX_SIZE) {
      alert.textContent = `文件${file.name} 超过50MB，无法上传`;
      continue;
    }
    let base64 = await toBase64(file);
    old.push({ name: file.name, size: file.size, base64 });
  }
  
  localStorage.setItem('myDiskFiles', JSON.stringify(old));
  loadFiles();
};

// 转Base64
function toBase64(file) {
  return new Promise(res => {
    let fr = new FileReader();
    fr.onload = () => res(fr.result);
    fr.readAsDataURL(file);
  });
}

// 下载
function downloadFile(index) {
  let files = JSON.parse(localStorage.getItem('myDiskFiles'));
  let a = document.createElement('a');
  a.href = files[index].base64;
  a.download = files[index].name;
  a.click();
}

// 删除
function deleteFile(index) {
  let files = JSON.parse(localStorage.getItem('myDiskFiles'));
  files.splice(index, 1);
  localStorage.setItem('myDiskFiles', JSON.stringify(files));
  loadFiles();
}

// 搜索功能
searchInput.oninput = () => {
  let keyword = searchInput.value.toLowerCase();
  let files = JSON.parse(localStorage.getItem('myDiskFiles') || '[]');
  let filtered = files.filter(f => f.name.toLowerCase().includes(keyword));
  renderFiles(filtered);
};

loadFiles();
</script>
</body>
</html>
